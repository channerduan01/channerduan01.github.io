## 1. 网络互联模型
开放系统互联参考模型 OSI/RM(Open System Interconnection/Reference Model)，由下到上七层模型：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层

互联网协议（Internet Protocol Suite）又称为 TCP/IP 协议族，是一个网路通信模型以及一整个网络传输协议家族，为互联网的基础通信架构；由下到上四层模型：网络接口层（OSI 物理层+数据链路层）、网际层（OSI 网络层）、传输层（OSI 传输层）、应用层（OSI 会话层+表示层+应用层），常被视为简化的OSI模型

### 1.1 七层模型解释

- 应用层：处理网络应用，直接为端用户服务。代表协议例如 HTTP、Tenlent、FTP、SMTP
- 表示层：数据表示，使应用层可以理解数据含义，例如 JPEG、ASCII、GIF 等
- 会话层：互联主机通信，管理远程用户进程间的通信，例如 RPC、SQL 等
- 传输层：端到端连接（应用程序->应用程序），实现发送端和接手端的数据分组传送，保证数据包无差错、按顺序、无丢失和无冗余的传输（实现可靠传输），代表协议例如 TCP、UDP、SPX 等
- 网络层：分组传输和路由选择，通过网络链接交换数据，解决路由选择、网络拥塞、异构网络互联问题。代表协议例如 IP、IPX 等
- 数据链路层：以桢为单位传输，建立、维持和释放网络实体之间的数据链路（实现无差错传输）。代表协议例如 IEEE802.3/.2、HDLC、PPP 等
- 物理层：二进制传输，物理设备链接，串口通信

### 1.2 常见应用层协议

- FTP (File Transport Protocal) 文件传输协议：建立在 TCP 之上，通过网络实现文件在计算机之间互传，传输模式包括 Bin（二进制）和 ASCII（文本文件）两种。FTP在客户机和服务器之间需要建立 2条 TCP链接，分别用于传送控制信息（21号端口）和传送文件内容（20号端口）
- TFTP (Trivial FTP) 简单文件传输协议，建立在 UDP 之上，提供简单的文件传输。
- HTTP (Hypertext Transfer Protocol) 超文本传输协议，建立在 TCP 之上，用于从WWW服务器传输超文本到本地浏览器，使浏览器更加高效。

### 1.3 常见传输层协议

- TCP (Transmission Control Protocol)：整个 TCP/IP 协议族中最重要的协议之一，在 IP 协议提供的不可靠数据服务基础上，提供了可靠地（校验、重传）、面向连接的（三次握手、四次挥手）、全双工的数据传输服务。一般用于数据量比较少，可靠性要求高的场景。
- UDP (User Datagram Protocol)：是一种不可靠的、无连接的协议。相对 TCP 其错误检测功能很弱，但是传输速率很高。一般用于数据量大，要求速度快，可靠性要求不高的场景（例如视频直播）。


#### TCP
TCP 传输控制协议 是一种可靠的、面向连接的字节流服务。起建立在无连接的IP协议基础上，因此使用3中机制实现连接：

- 使用序号对数据进行标记
- TCP使用确认、校验和定时器提供可靠性，提供重传机制
- TCP使用窗口机制调整数据流量，并且窗口的大小不是固定的，会根据网络情况进行调整

其会对所有数据（TCP报头/首部+数据部）进行校验。

#### UDP
UDP 是一种不可靠的、无连接的数据报服务。源主机在传送数据前不需要和目标主机建立连接。

只对首部进行校验，甚至也能完全不校验。其仅最大努力交付，单不保证可靠交付，不建立连接也不维持连接状态。首部8字节比TCP20字节短。


### 1.4 常见网络层协议

- IP：处理信息的路由和主机地址解析，完成主机到主机的端到端（传输层是应用到应用的端到端），其服务无连接且不可靠（所以可靠性需要 TCP 补位）
- 其他：ICMP (Internet Group Management Protocol) 网际组管理协议、ARP (Address Resolution Protocol) 地址解析协议、RARP (Reverse Address Resolution Protocol) 反向地址解析协议


## 2. IP（IPV4）
由 32位 的二进制数的逻辑地址，也常分为4个字节（每个字节十进制取值[0,255]）用‘.’分割表示，日路 “192.168.200.128”。

IP地址由两个部分组成：网络号+主机号，网络号和主机号的“全零”或“全一”不用。通常又分为：

- A类，国家级，政府机关使用：第1位=0，前8位作网络号（取值 [1,126]，网络号“全零”或“全一”不用），剩下的24位作主机号
- B类，大型企业使用：前2位=10，前16位作网络号（取值 [128,191]），剩下16位作主机号
- C类，普通家用：前3位=110，前27位作为网络号（取值 [192,223]），剩下8位作主机好
- D类，组播地址：前4位=1110
- E类，保留地址：前4位=1110

### 2.1 子网掩码
三级IP地址：网络号+子网号+主机号，隔离子网方便管理、提升安全性和主机号使用效率；实际上是从主机号中借出几位设置子网号，追加成子网络号。

子网掩码：32位二进制数，网络和子网位标识为1，主机标识为0；例如 C类地址默认子网掩码 “255.255.255.0”。子网掩码和IP地址作与运算，得到子网络地址（网络号+子网号）。

举例1：“131.1.123.24/27” 中 “27” 表示该地址前27位标识网络号（子网掩码即 255.255.255.224），主机号是5位。
举例2：“220.17.192.0/20” 中 “20” 表示该地址前20位标识网络号（子网掩码即 255.255.240.0），可划分为 16个 标准C类子网（各对应入子网掩码 “255.255.255.0”）。

### 2.2 IPv4数据报
数据报为：首部+数据部分，首部细分为：

- 版本（4位）：IP协议版本，写为4
- 首部长度（4位）：最大可标识15个单位（每个单位4字节），60字节
- 区分服务（8位）：DS字段，标识服务优先级，只有在使用区分服务（DiffServ）时生效
- 总长度（16位）首部+数据之和的长度，最大为2^16-1=65535字节
- 标识（16位）：唯一标识数据报
- 标志（4位）：是否分片、是否分完
- 片偏移（12位）：处于原始数据的偏移量
- 生存时间（8位）：记为 TTL (Time To Live)，只是数据报在网络中可通过路由器的最大值，用于处理路由循环
- 协议（8位）：数据报携带的协议（例如 TCP、UDP、IGMP 等）
- 首部校验和（16位）：只对首部做校验，采用16位二进制反码求和（所以数据不可靠）
- 可选字段：通过路径、安全信息等
- 填充：保证首部为4字节的倍数

### 2.3 IPv6
1995年12月推出了 IPv6协议，总计128位，以16位为一段，共分为8段（每段通常使用 4位 16进制数表示），例如 “2001:da8:d001:1:0:0:0:1”

IPv6 相对 IPv4 的优势：

- 有更大的地址空间
- 使用更小的路由表
- 增加了组播支持和对流支持
- 加入了自动配置支持
- 具有更高的安全性

IPv4/IPv6 过滤技术：

- 双协议栈技术：节点同时支持两种协议
- 隧道技术：通过在 IPv4 中部署隧道，承接 IPv6 业务
- NAT-PT 技术：两种协议之间翻译转换

IPv6数据报：
基本首部（40字节）+有效载荷，首部：

- 版本：IP协议版本，写为6
- 流量分类：通信类型，相当于IPv4的“区分服务”
- 流标签：标识一个流上所有数据报，保证服务质量
- 有效载荷长度：标识除首部外的字节数，最大值64KB（包含扩展首部+有效载荷）
- 下一头部：相当于IPv4中的协议字段或可选字段
- 跳数限制：相当于IPv4中的生存时间

IPv6数据报的目的地址可以是：

- 单播：传统点对点
- 多播/组播：一点对多点
- 任播：IPv6新增类型，一点对多点，交给距离最近的计算机


## 3. 其他
### 3.1 域名和地址
Internet 地址分为3级：网络地址+主机地址+端口地址，其中 网络地址+主机地址 即为 IP地址，而 端口地址 就是 TCP/UDP 地址，用于标识上层进程的服务方位点（大多数公共应用端口号小于 1024，而用户进程端口号一般大于 1024）

域名系统 DNS (Domain Name System) 是把注意域名解析为IP地址的系统，解决了IP地址记忆困难的问题。DNS使用了UDP协议（极少情况下使用TCP），端口号均为 53，由3部分构成：DNS名字空间、域名服务器、DNS客户机。

域名：

- 根域：处于Internet域名空间结构树的最高端，用‘.’来表示
- 顶级域名：在根域之下，分为 国家顶级域名、通用顶级域名、国际顶级域名；例如 com/edu/gov/net/org/...
- 二级域名：真实注册给组织和个人的唯一名称；二级域名之下，组织机构还可以划分子域
- 主机：最底层域名，处于域名树的叶子端，代表各主机提供的服务

域名服务器：

- 主域名服务器：维护本区所有域名信息
- 辅助域名服务器：主域名服务器的备份
- 缓存域名服务器：向其他域名服务器查询后缓存结果
- 转发域名服务器：负责非本地和缓存中没有的域名查询转发到指定的域名服务器

域名查询算法：

- 递归查询：当用户发出查询请求时，递归查询到结果并返回（负责到底）
- 地带查询：当用户发出查询请求时，可能返回其他服务器引用（让用户去其他地方再找找）


### 3.2 网络设计
分层设计，总计4个层次：

- 出口层：连接运营商 ISP (Internet Service Provider) 
- 核心层：网络主干部分，负责高速转发通信，其交换机要求更高的可能性和性能，通常采用双机冗余热备份
- 汇聚层（一般是大规模网络才需要）：负责网络访问策略控制、数据包处理/过滤/寻址；要求设备性能比接入层高
- 接入层：直接面向用户连接/访问，还适当负责一些用户管理（用户认证、计费）和用户信息收集（用户IP地址、MAC地址、访问日志）

### 3.3 综合布线系统
用于传输语音、数据、影像和其他信息的标准结构化布线系统。系统结构分为6个子系统：

- 工作区子系统：终端设备链接到信息插座，包括计算机、电话、探头、监视器等
- 水平子系统：同一楼层上连接，一端连接插座一端连接在跳线上；其将垂直子系统延伸到用户工作区，将用户工作区引至管理子系统
- 管理子系统：垂直子系统和水平子系统的桥梁，并为同层组网提供条件，集中管理系统 
- 垂直（干线）子系统：将主设备间连接到各层管理间
- 设备间子系统：整个配线系统的中心单元
- 建筑群子系统：将多个建筑物的数据通信信号连成一体

### 3.4 网络常见设备

- 中继器：物理层，用于拓展网线
- 网桥：数据链路层，用于网络之前的信息转发
- 路由器：网络层，通过逻辑地址进行网络之间的细细转发
- 网关：第4-7层，最复杂的网络互联设备，用于执行不同协议
- 集线器：物理层，多端口中继器
- 二层交换机：数据链路层，多端口网桥
- 三层交换机：网络层，带路由功能的二层交换机
- 多层交换机：第4-7层，带协议转换的交换机

### 3.5 网络存储技术

- DAS (Direct Attached Storage) 直接附加存储：存储设备通过 SCSI (Small Computer System Inferface) 电缆直接连接到服务器，硬件处理；适用于服务器在地理上分散（NAS 或 SAN 互联困难），或存储系统必须直连时。该模式已经被 NAS 替代。
- NAS (Network Attrached Storage) 网络附加存储：存储设备不再通过 I/O 总线连接服务器，而是通过网络接口连接。类似于专用的文件服务器，专门提供文件系统功能；其存储支持即插即用，可以再网络的任一位置建立存储，方便拓展，但是性能有限。
- SAN (Storage Area Network) 存储区域网络：大型网络才使用此架构，在 NAS 基础上网络连接采用专用交换机实现。

### 3.6 网络系统建设原则

- 采用先进，成熟的技术
- 遵循国际标准，坚持开放性原则
- 网络的可管理性（监控、统计、分析、诊断）
- 系统的安全性（不同用户权限管控）
- 灵活性和扩充性
- 系统的稳定性和可靠性
- 经济型
- 实用性
